<p>
    Taking inspiration from the Fama French five-factor model, we can develop a multi-factor stock selection strategy that focuses on five factors: size, value, quality, profitability, and investment pattern. 
</p>
<p>
    In the following backtest,  we use the terms TotalEquity, BookValuePerShare, OperationProfitMargin, ROE, and TotalAssetsGrowth to account for the five factors, respectively. We then calculate a custom ranking metric for each stock using these five terms. Our algorithm will go long in the five stocks with the highest scores and short the five stocks with the lowest scores.
</p>
<div class="section-example-container">
<pre class="python">
def FineSelectionFunction(self, fine):
    '''Select securities with highest score on Fama French 5 factors'''

    # Select stocks with these 5 factors:
    # MKT -- Book value per share: Value
    # SMB -- TotalEquity: Size
    # HML -- Operation profit margin: Quality
    # RMW -- ROE: Profitability
    # CMA -- TotalAssetsGrowth: Investment Pattern
    filtered = [x for x in fine if x.ValuationRatios.BookValuePerShare
                                and x.FinancialStatements.BalanceSheet.TotalEquity
                                and x.OperationRatios.OperationMargin.Value
                                and x.OperationRatios.ROE
                                and x.OperationRatios.TotalAssetsGrowth]

    # Sort by factors
    sortedByMkt = sorted(filtered, key=lambda x: x.ValuationRatios.BookValuePerShare, reverse=True)
    sortedBySmb = sorted(filtered, key=lambda x: x.FinancialStatements.BalanceSheet.TotalEquity.Value, reverse=True)
    sortedByHml = sorted(filtered, key=lambda x: x.OperationRatios.OperationMargin.Value, reverse=True)
    sortedByRmw = sorted(filtered, key=lambda x: x.OperationRatios.ROE.Value, reverse=True)
    sortedByCma = sorted(filtered, key=lambda x: x.OperationRatios.TotalAssetsGrowth.Value, reverse=False)

    stockBySymbol = {}

    # Get the rank based on 5 factors for every stock
    for index, stock in enumerate(sortedByMkt):
        mktRank = self.beta_m * index
        smbRank = self.beta_s * sortedBySmb.index(stock)
        hmlRank = self.beta_h * sortedByHml.index(stock)
        rmwRank = self.beta_r * sortedByRmw.index(stock)
        cmaRank = self.beta_c * sortedByCma.index(stock)
        avgRank = np.mean([mktRank,smbRank,hmlRank,rmwRank,cmaRank])
        stockBySymbol[stock.Symbol] = avgRank

    sorted_dict = sorted(stockBySymbol.items(), key = lambda x: x[1], reverse = True)
    symbols = [x[0] for x in sorted_dict]

    # Pick the stocks with the highest scores to long
    self.longSymbols= symbols[:self.num_long]
    # Pick the stocks with the lowest scores to short
    self.shortSymbols = symbols[-self.num_short:]

    return self.longSymbols + self.shortSymbols   
</pre>
</div>

<p>
    In this example, the portfolio is rebalanced every 30 days and the backtest period runs from Jan 2010 to Aug 2019. You can improve upon this strategy by changing the fundamental factors, the weight of each factor and the rebalance frequency.
</p>

<div class="qc-embed-frame" style="display: inline-block; position: relative; width: 100%; min-height: 100px; min-width: 300px;">
    <div class="qc-embed-dummy" style="padding-top: 56.25%;"></div>
    <div class="qc-embed-element" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0;">
        <iframe class="qc-embed-backtest" height="100%" width="100%" style="border: 1px solid #ccc; padding: 0; margin: 0;" src="https://www.quantconnect.com/terminal/processCache?request=embedded_backtest_78601a5bd785ca32803c13525c688046.html"></iframe>
    </div>
</div>

<p>
    The Fama French five-factor model provides a scientific way to measure asset pricing. For the five aspects that Fama and French mentioned, we used one possible combination in our backtest. We can see from the results that it achieves an annual rate of return around 5% with a max drawdown of 30% over 8 years.
    These factors perhaps cannot capture a sufficient amount of information on the assets' pricing, and therefore, there are still many aspects can be improved (e.g. the weights of factors, a different set of factors for different kinds of equities,etc.) We encourage you to explore and create better algorithms upon this tutorial!
</p>